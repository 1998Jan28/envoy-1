
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>v2 API 概览 · Envoy proxy中文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="ServiceMesher">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-ghcolors.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="v1_overview.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"repo":"servicemesher/envoyproxy","types":["star"],"size":"small"};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">说明</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                        <b>1.1.</b>
                    
                    介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../about_docs.html">
            
                <a href="../../about_docs.html">
            
                    
                        <b>1.2.</b>
                    
                    关于本文档
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">简介</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../intro/what_is_envoy.html">
            
                <a href="../../intro/what_is_envoy.html">
            
                    
                        <b>2.1.</b>
                    
                    Envoy 是什么？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../intro/what_is_envoy.html">
            
                <a href="../../intro/what_is_envoy.html">
            
                    
                        <b>2.2.</b>
                    
                    架构概览
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../../intro/arch_overview/terminology.html">
            
                <a href="../../intro/arch_overview/terminology.html">
            
                    
                        <b>2.2.1.</b>
                    
                    术语
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../../intro/arch_overview/threading_model.html">
            
                <a href="../../intro/arch_overview/threading_model.html">
            
                    
                        <b>2.2.2.</b>
                    
                    线程模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../../intro/arch_overview/listeners.html">
            
                <a href="../../intro/arch_overview/listeners.html">
            
                    
                        <b>2.2.3.</b>
                    
                    Listener
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="../../intro/arch_overview/listener_filters.html">
            
                <a href="../../intro/arch_overview/listener_filters.html">
            
                    
                        <b>2.2.4.</b>
                    
                    Listener filter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="../../intro/arch_overview/network_filters.html">
            
                <a href="../../intro/arch_overview/network_filters.html">
            
                    
                        <b>2.2.5.</b>
                    
                    Network (L3/L4) filter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.6" data-path="../../intro/arch_overview/http_connection_management.html">
            
                <a href="../../intro/arch_overview/http_connection_management.html">
            
                    
                        <b>2.2.6.</b>
                    
                    HTTP 连接管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7" data-path="../../intro/arch_overview/http_filters.html">
            
                <a href="../../intro/arch_overview/http_filters.html">
            
                    
                        <b>2.2.7.</b>
                    
                    HTTP filter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.8" data-path="../../intro/arch_overview/http_routing.html">
            
                <a href="../../intro/arch_overview/http_routing.html">
            
                    
                        <b>2.2.8.</b>
                    
                    HTTP 路由
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.9" data-path="../../intro/arch_overview/grpc.html">
            
                <a href="../../intro/arch_overview/grpc.html">
            
                    
                        <b>2.2.9.</b>
                    
                    gRPC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.10" data-path="../../intro/arch_overview/websocket.html">
            
                <a href="../../intro/arch_overview/websocket.html">
            
                    
                        <b>2.2.10.</b>
                    
                    WebSocket 支持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.11" data-path="../../intro/arch_overview/cluster_manager.html">
            
                <a href="../../intro/arch_overview/cluster_manager.html">
            
                    
                        <b>2.2.11.</b>
                    
                    Cluster manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.12" data-path="../../intro/arch_overview/service_discovery.html">
            
                <a href="../../intro/arch_overview/service_discovery.html">
            
                    
                        <b>2.2.12.</b>
                    
                    服务发现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.13" data-path="../../intro/arch_overview/health_checking.html">
            
                <a href="../../intro/arch_overview/health_checking.html">
            
                    
                        <b>2.2.13.</b>
                    
                    健康检查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.14" data-path="../../intro/arch_overview/connection_pooling.html">
            
                <a href="../../intro/arch_overview/connection_pooling.html">
            
                    
                        <b>2.2.14.</b>
                    
                    连接池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.15" data-path="../../intro/arch_overview/load_balancing.html">
            
                <a href="../../intro/arch_overview/load_balancing.html">
            
                    
                        <b>2.2.15.</b>
                    
                    负载均衡
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.16" data-path="../../intro/arch_overview/outlier.html">
            
                <a href="../../intro/arch_overview/outlier.html">
            
                    
                        <b>2.2.16.</b>
                    
                    异常点检测
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.17" data-path="../../intro/arch_overview/circuit_breaking.html">
            
                <a href="../../intro/arch_overview/circuit_breaking.html">
            
                    
                        <b>2.2.17.</b>
                    
                    断路器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.18" data-path="../../intro/arch_overview/global_rate_limiting.html">
            
                <a href="../../intro/arch_overview/global_rate_limiting.html">
            
                    
                        <b>2.2.18.</b>
                    
                    全局速率限制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.19" data-path="../../intro/arch_overview/ssl.html">
            
                <a href="../../intro/arch_overview/ssl.html">
            
                    
                        <b>2.2.19.</b>
                    
                    TLS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.20" data-path="../../intro/arch_overview/statistics.html">
            
                <a href="../../intro/arch_overview/statistics.html">
            
                    
                        <b>2.2.20.</b>
                    
                    统计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.21" data-path="../../intro/arch_overview/runtime.html">
            
                <a href="../../intro/arch_overview/runtime.html">
            
                    
                        <b>2.2.21.</b>
                    
                    运行时配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.22" data-path="../../intro/arch_overview/tracing.html">
            
                <a href="../../intro/arch_overview/tracing.html">
            
                    
                        <b>2.2.22.</b>
                    
                    追踪
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.23" data-path="../../intro/arch_overview/tcp_proxy.html">
            
                <a href="../../intro/arch_overview/tcp_proxy.html">
            
                    
                        <b>2.2.23.</b>
                    
                    TCP 代理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.24" data-path="../../intro/arch_overview/access_logging.html">
            
                <a href="../../intro/arch_overview/access_logging.html">
            
                    
                        <b>2.2.24.</b>
                    
                    访问记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.25" data-path="../../intro/arch_overview/mongo.html">
            
                <a href="../../intro/arch_overview/mongo.html">
            
                    
                        <b>2.2.25.</b>
                    
                    MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.26" data-path="../../intro/arch_overview/dynamo.html">
            
                <a href="../../intro/arch_overview/dynamo.html">
            
                    
                        <b>2.2.26.</b>
                    
                    DynamoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.27" data-path="../../intro/arch_overview/redis.html">
            
                <a href="../../intro/arch_overview/redis.html">
            
                    
                        <b>2.2.27.</b>
                    
                    Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.28" data-path="../../intro/arch_overview/hot_restart.html">
            
                <a href="../../intro/arch_overview/hot_restart.html">
            
                    
                        <b>2.2.28.</b>
                    
                    热重启
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.29" data-path="../../intro/arch_overview/dynamic_configuration.html">
            
                <a href="../../intro/arch_overview/dynamic_configuration.html">
            
                    
                        <b>2.2.29.</b>
                    
                    动态配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.30" data-path="../../intro/arch_overview/init.html">
            
                <a href="../../intro/arch_overview/init.html">
            
                    
                        <b>2.2.30.</b>
                    
                    初始化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.31" data-path="../../intro/arch_overview/draining.html">
            
                <a href="../../intro/arch_overview/draining.html">
            
                    
                        <b>2.2.31.</b>
                    
                    排除
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.32" data-path="../../intro/arch_overview/scripting.html">
            
                <a href="../../intro/arch_overview/scripting.html">
            
                    
                        <b>2.2.32.</b>
                    
                    脚本
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../intro/deployment_types/deployment_types.html">
            
                <a href="../../intro/deployment_types/deployment_types.html">
            
                    
                        <b>2.3.</b>
                    
                    部署类型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../../intro/deployment_types/service_to_service.html">
            
                <a href="../../intro/deployment_types/service_to_service.html">
            
                    
                        <b>2.3.1.</b>
                    
                    仅服务之间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../../intro/deployment_types/front_proxy.html">
            
                <a href="../../intro/deployment_types/front_proxy.html">
            
                    
                        <b>2.3.2.</b>
                    
                    服务之间外加前端代理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../../intro/deployment_types/double_proxy.html">
            
                <a href="../../intro/deployment_types/double_proxy.html">
            
                    
                        <b>2.3.3.</b>
                    
                    服务间、前端代理、双向代理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../intro/comparison.html">
            
                <a href="../../intro/comparison.html">
            
                    
                        <b>2.4.</b>
                    
                    与类似系统比较
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../intro/getting_help.html">
            
                <a href="../../intro/getting_help.html">
            
                    
                        <b>2.5.</b>
                    
                    获取帮助
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../intro/version_history.html">
            
                <a href="../../intro/version_history.html">
            
                    
                        <b>2.6.</b>
                    
                    历史版本
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">入门指南</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../start/start.html">
            
                <a href="../../start/start.html">
            
                    
                        <b>3.1.</b>
                    
                    入门指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <span>
            
                    
                        <b>3.2.</b>
                    
                    Sandbox
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../../start/sandboxes/front_proxy.html">
            
                <a href="../../start/sandboxes/front_proxy.html">
            
                    
                        <b>3.2.1.</b>
                    
                    前端代理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../../start/sandboxes/zipkin_tracing.html">
            
                <a href="../../start/sandboxes/zipkin_tracing.html">
            
                    
                        <b>3.2.2.</b>
                    
                    Zipkin 追踪
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../../start/sandboxes/jaeger_tracing.html">
            
                <a href="../../start/sandboxes/jaeger_tracing.html">
            
                    
                        <b>3.2.3.</b>
                    
                    Jaeger 追踪
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="../../start/sandboxes/jaeger_native_tracing.html">
            
                <a href="../../start/sandboxes/jaeger_native_tracing.html">
            
                    
                        <b>3.2.4.</b>
                    
                    Jaeger 原生追踪
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" >
            
                <span>
            
                    
                        <b>3.3.</b>
                    
                    其他用例
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../../start/distro/ambassador.html">
            
                <a href="../../start/distro/ambassador.html">
            
                    
                        <b>3.3.1.</b>
                    
                    Envoy 作为 Kubernetes 的 API 网关
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">构建和安装</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../install/building.html">
            
                <a href="../../install/building.html">
            
                    
                        <b>4.1.</b>
                    
                    构建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../install/ref_configs.html">
            
                <a href="../../install/ref_configs.html">
            
                    
                        <b>4.2.</b>
                    
                    参考配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" >
            
                <span>
            
                    
                        <b>4.3.</b>
                    
                    工具
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../../install/tools/config_load_check_tool.html">
            
                <a href="../../install/tools/config_load_check_tool.html">
            
                    
                        <b>4.3.1.</b>
                    
                    配置负载检查工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="../../install/tools/route_table_check_tool.html">
            
                <a href="../../install/tools/route_table_check_tool.html">
            
                    
                        <b>4.3.2.</b>
                    
                    路由表检查工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="../../install/tools/schema_validator_check_tool.html">
            
                <a href="../../install/tools/schema_validator_check_tool.html">
            
                    
                        <b>4.3.3.</b>
                    
                    Schema 验证器检查工具
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">配置参考</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="v1_overview.html">
            
                <a href="v1_overview.html">
            
                    
                        <b>5.1.</b>
                    
                    v1 API 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="5.2" data-path="v2_overview.html">
            
                <a href="v2_overview.html">
            
                    
                        <b>5.2.</b>
                    
                    v2 API 概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" >
            
                <span>
            
                    
                        <b>5.3.</b>
                    
                    Listener
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.3.1" data-path="../listeners/stats.html">
            
                <a href="../listeners/stats.html">
            
                    
                        <b>5.3.1.</b>
                    
                    统计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.2" data-path="../listeners/runtime.html">
            
                <a href="../listeners/runtime.html">
            
                    
                        <b>5.3.2.</b>
                    
                    运行时
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.3" data-path="../listeners/lds.html">
            
                <a href="../listeners/lds.html">
            
                    
                        <b>5.3.3.</b>
                    
                    Listener 发现服务（LDS）
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.4" >
            
                <span>
            
                    
                        <b>5.4.</b>
                    
                    Listener filter
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.4.1" data-path="../listener_filters/original_dst_filter.html">
            
                <a href="../listener_filters/original_dst_filter.html">
            
                    
                        <b>5.4.1.</b>
                    
                    原始目的地
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4.2" data-path="../listener_filters/tls_inspector.html">
            
                <a href="../listener_filters/tls_inspector.html">
            
                    
                        <b>5.4.2.</b>
                    
                    TLS 检查器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.5" >
            
                <span>
            
                    
                        <b>5.5.</b>
                    
                    网络 filter
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.5.1" data-path="../network_filters/client_ssl_auth_filter.html">
            
                <a href="../network_filters/client_ssl_auth_filter.html">
            
                    
                        <b>5.5.1.</b>
                    
                    客户端 TLS 身份验证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.2" data-path="../network_filters/echo_filter.html">
            
                <a href="../network_filters/echo_filter.html">
            
                    
                        <b>5.5.2.</b>
                    
                    Echo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.3" data-path="../network_filters/mongo_proxy_filter.html">
            
                <a href="../network_filters/mongo_proxy_filter.html">
            
                    
                        <b>5.5.3.</b>
                    
                    Mongo 代理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.4" data-path="../network_filters/rate_limit_filter.html">
            
                <a href="../network_filters/rate_limit_filter.html">
            
                    
                        <b>5.5.4.</b>
                    
                    速率限制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.5" data-path="../network_filters/redis_proxy_filter.html">
            
                <a href="../network_filters/redis_proxy_filter.html">
            
                    
                        <b>5.5.5.</b>
                    
                    Redis 代理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.6" data-path="../network_filters/tcp_proxy_filter.html">
            
                <a href="../network_filters/tcp_proxy_filter.html">
            
                    
                        <b>5.5.6.</b>
                    
                    TCP 代理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.6" >
            
                <span>
            
                    
                        <b>5.6.</b>
                    
                    HTTP 连接管理器
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.6.1" data-path="../http_conn_man/route_matching.html">
            
                <a href="../http_conn_man/route_matching.html">
            
                    
                        <b>5.6.1.</b>
                    
                    路由匹配
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6.2" data-path="../http_conn_man/traffic_splitting.html">
            
                <a href="../http_conn_man/traffic_splitting.html">
            
                    
                        <b>5.6.2.</b>
                    
                    流量转换/切分
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6.3" data-path="../http_conn_man/headers.html">
            
                <a href="../http_conn_man/headers.html">
            
                    
                        <b>5.6.3.</b>
                    
                    HTTP header 操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6.4" data-path="../http_conn_man/header_sanitizing.html">
            
                <a href="../http_conn_man/header_sanitizing.html">
            
                    
                        <b>5.6.4.</b>
                    
                    HTTP header sanitizing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6.5" data-path="../http_conn_man/stats.html">
            
                <a href="../http_conn_man/stats.html">
            
                    
                        <b>5.6.5.</b>
                    
                    统计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6.6" data-path="../http_conn_man/runtime.html">
            
                <a href="../http_conn_man/runtime.html">
            
                    
                        <b>5.6.6.</b>
                    
                    运行时
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6.7" data-path="../http_conn_man/rds.html">
            
                <a href="../http_conn_man/rds.html">
            
                    
                        <b>5.6.7.</b>
                    
                    路由发现服务（RDS）
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.7" >
            
                <span>
            
                    
                        <b>5.7.</b>
                    
                    HTTP filter
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.7.1" data-path="../http_filters/buffer_filter.html">
            
                <a href="../http_filters/buffer_filter.html">
            
                    
                        <b>5.7.1.</b>
                    
                    Buffer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.2" data-path="../http_filters/cors_filter.html">
            
                <a href="../http_filters/cors_filter.html">
            
                    
                        <b>5.7.2.</b>
                    
                    CORS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.3" data-path="../http_filters/dynamodb_filter.html">
            
                <a href="../http_filters/dynamodb_filter.html">
            
                    
                        <b>5.7.3.</b>
                    
                    DynamoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.4" data-path="../http_filters/fault_filter.html">
            
                <a href="../http_filters/fault_filter.html">
            
                    
                        <b>5.7.4.</b>
                    
                    故障注入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.5" data-path="../http_filters/grpc_http1_bridge_filter.html">
            
                <a href="../http_filters/grpc_http1_bridge_filter.html">
            
                    
                        <b>5.7.5.</b>
                    
                    gRPC HTTP/1.1 bridge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.6" data-path="../http_filters/grpc_json_transcoder_filter.html">
            
                <a href="../http_filters/grpc_json_transcoder_filter.html">
            
                    
                        <b>5.7.6.</b>
                    
                    gRPC-JSON 转码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.7" data-path="../http_filters/grpc_web_filter.html">
            
                <a href="../http_filters/grpc_web_filter.html">
            
                    
                        <b>5.7.7.</b>
                    
                    gRPC-Web
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.8" data-path="../http_filters/gzip_filter.html">
            
                <a href="../http_filters/gzip_filter.html">
            
                    
                        <b>5.7.8.</b>
                    
                    Gzip
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.9" data-path="../http_filters/health_check_filter.html">
            
                <a href="../http_filters/health_check_filter.html">
            
                    
                        <b>5.7.9.</b>
                    
                    健康检查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.10" data-path="../http_filters/ip_tagging_filter.html">
            
                <a href="../http_filters/ip_tagging_filter.html">
            
                    
                        <b>5.7.10.</b>
                    
                    IP Tagging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.11" data-path="../http_filters/lua_filter.html">
            
                <a href="../http_filters/lua_filter.html">
            
                    
                        <b>5.7.11.</b>
                    
                    Lua
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.12" data-path="../http_filters/rate_limit_filter.html">
            
                <a href="../http_filters/rate_limit_filter.html">
            
                    
                        <b>5.7.12.</b>
                    
                    速率限制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.13" data-path="../http_filters/router_filter.html">
            
                <a href="../http_filters/router_filter.html">
            
                    
                        <b>5.7.13.</b>
                    
                    路由
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7.14" data-path="../http_filters/squash_filter.html">
            
                <a href="../http_filters/squash_filter.html">
            
                    
                        <b>5.7.14.</b>
                    
                    Squash
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.8" >
            
                <span>
            
                    
                        <b>5.8.</b>
                    
                    Cluster Manager
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.8.1" data-path="../cluster_manager/cluster_stats.html">
            
                <a href="../cluster_manager/cluster_stats.html">
            
                    
                        <b>5.8.1.</b>
                    
                    统计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.8.2" data-path="../cluster_manager/cluster_runtime.html">
            
                <a href="../cluster_manager/cluster_runtime.html">
            
                    
                        <b>5.8.2.</b>
                    
                    运行时
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.8.3" data-path="../cluster_manager/cds.html">
            
                <a href="../cluster_manager/cds.html">
            
                    
                        <b>5.8.3.</b>
                    
                    集群发现服务（CDS）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.8.4" data-path="../cluster_manager/cluster_hc.html">
            
                <a href="../cluster_manager/cluster_hc.html">
            
                    
                        <b>5.8.4.</b>
                    
                    健康检查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.8.5" data-path="../cluster_manager/cluster_circuit_breakers.html">
            
                <a href="../cluster_manager/cluster_circuit_breakers.html">
            
                    
                        <b>5.8.5.</b>
                    
                    断路
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.9" >
            
                <span>
            
                    
                        <b>5.9.</b>
                    
                    健康检查器
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.9.1" data-path="../health_checkers/redis.html">
            
                <a href="../health_checkers/redis.html">
            
                    
                        <b>5.9.1.</b>
                    
                    Redis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="../access_log.html">
            
                <a href="../access_log.html">
            
                    
                        <b>5.10.</b>
                    
                    访问记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="../rate_limit.html">
            
                <a href="../rate_limit.html">
            
                    
                        <b>5.11.</b>
                    
                    速率限制服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.12" data-path="../runtime.html">
            
                <a href="../runtime.html">
            
                    
                        <b>5.12.</b>
                    
                    运行时
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.13" data-path="../statistics.html">
            
                <a href="../statistics.html">
            
                    
                        <b>5.13.</b>
                    
                    统计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.14" data-path="../tools/router_check.html">
            
                <a href="../tools/router_check.html">
            
                    
                        <b>5.14.</b>
                    
                    路由表检查工具
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">运维管理</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../operations/cli.html">
            
                <a href="../../operations/cli.html">
            
                    
                        <b>6.1.</b>
                    
                    命令行选项
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../../operations/hot_restarter.html">
            
                <a href="../../operations/hot_restarter.html">
            
                    
                        <b>6.2.</b>
                    
                    热重启 Python 包装器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../../operations/admin.html">
            
                <a href="../../operations/admin.html">
            
                    
                        <b>6.3.</b>
                    
                    管理接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../../operations/stats_overview.html">
            
                <a href="../../operations/stats_overview.html">
            
                    
                        <b>6.4.</b>
                    
                    统计概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../../operations/runtime.html">
            
                <a href="../../operations/runtime.html">
            
                    
                        <b>6.5.</b>
                    
                    运行时
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="../../operations/fs_flags.html">
            
                <a href="../../operations/fs_flags.html">
            
                    
                        <b>6.6.</b>
                    
                    文件系统标志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="../../operations/traffic_capture.html">
            
                <a href="../../operations/traffic_capture.html">
            
                    
                        <b>6.7.</b>
                    
                    流量捕获
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="../../extending/extending.html">
            
                <a href="../../extending/extending.html">
            
                    
                        <b>6.8.</b>
                    
                    为自定义用例扩展 Envoy
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">API 参考</li>
        
        
    
        <li class="chapter " data-level="7.1" >
            
                <a target="_blank" href="https://www.envoyproxy.io/docs/envoy/latest/api-v1/api">
            
                    
                        <b>7.1.</b>
                    
                    v1 API 参考
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" >
            
                <a target="_blank" href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api">
            
                    
                        <b>7.2.</b>
                    
                    v2 API 参考
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">常见问题</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../../faq/how_fast_is_envoy.html">
            
                <a href="../../faq/how_fast_is_envoy.html">
            
                    
                        <b>8.1.</b>
                    
                    Envoy 有多快？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../../faq/binaries.html">
            
                <a href="../../faq/binaries.html">
            
                    
                        <b>8.2.</b>
                    
                    从哪里能获得二进制文件？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../../faq/sni.html">
            
                <a href="../../faq/sni.html">
            
                    
                        <b>8.3.</b>
                    
                    如何设置 SNI？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="../../faq/zone_aware_routing.html">
            
                <a href="../../faq/zone_aware_routing.html">
            
                    
                        <b>8.4.</b>
                    
                    如何设置 zone 可感知路由？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="../../faq/zipkin_tracing.html">
            
                <a href="../../faq/zipkin_tracing.html">
            
                    
                        <b>8.5.</b>
                    
                    如何设置 Zipkin 追踪？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="../../faq/lb_panic_threshold.html">
            
                <a href="../../faq/lb_panic_threshold.html">
            
                    
                        <b>8.6.</b>
                    
                    我设置了健康检查，但是当有节点失败时，Envoy 又路由到那些节点，这是怎么回事？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="../../faq/concurrency_lb.html">
            
                <a href="../../faq/concurrency_lb.html">
            
                    
                        <b>8.7.</b>
                    
                    为什么 Round Robin 负载均衡看起来不起作用？
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >v2 API 概览</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="v2-api-&#x6982;&#x89C8;">v2 API &#x6982;&#x89C8;</h1>
<p>The Envoy v2 APIs are defined as <a href="https://developers.google.com/protocol-buffers/docs/proto3" target="_blank">proto3</a> <a href="https://developers.google.com/protocol-buffers/" target="_blank">Protocol Buffers</a> in the <a href="https://github.com/envoyproxy/data-plane-api/tree/master/api" target="_blank">data plane API repository</a>. They evolve the existing <a href="v1_overview.html#config-overview-v1">v1 APIs and concepts</a> to support:</p>
<ul>
<li>Streaming delivery of <a href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md" target="_blank">xDS</a> API updates via gRPC. This reduces resource requirements and can lower the update latency.</li>
<li>A new REST-JSON API in which the JSON/YAML formats are derived mechanically via the <a href="https://developers.google.com/protocol-buffers/docs/proto3#json" target="_blank">proto3 canonical JSON mapping</a>.</li>
<li>Delivery of updates via the filesystem, REST-JSON or gRPC endpoints.</li>
<li>Advanced load balancing through an extended endpoint assignment API and load and resource utilization reporting to management servers.</li>
<li><a href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md#eventual-consistency-considerations" target="_blank">Stronger consistency and ordering properties</a> when needed. The v2 APIs still maintain a baseline eventual consistency model.</li>
</ul>
<p>See the <a href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md" target="_blank">xDS protocol description</a> for further details on aspects of v2 message exchange between Envoy and the management server.</p>
<h2 id="bootstrap-&#x914D;&#x7F6E;">Bootstrap &#x914D;&#x7F6E;</h2>
<p>To use the v2 API, it&#x2019;s necessary to supply a bootstrap configuration file. This provides static server configuration and configures Envoy to access <a href="../../intro/arch_overview/dynamic_configuration.html#arch-overview-dynamic-config">dynamic configuration if needed</a>. As with the v1 JSON/YAML configuration, this is supplied on the command-line via the <a href="../../operations/cli.html#cmdoption-c"><code>-c</code></a> flag, i.e.:</p>
<pre class="language-"><code class="lang-bash">./envoy -c <span class="token operator">&lt;</span>path to config<span class="token operator">&gt;</span>.<span class="token punctuation">{</span>json,yaml,pb,pb_text<span class="token punctuation">}</span> --v2-config-only
</code></pre>
<p>where the extension reflects the underlying v2 config representation. The <a href="../../operations/cli.html#cmdoption-v2-config-only"><code>--v2-config-only</code></a> flag is not strictly required as Envoy will attempt to autodetect the config file version, but this option provides an enhanced debug experience when configuration parsing fails.</p>
<p>The <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> message is the root of the configuration. A key concept in the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> message is the distinction between static and dynamic resouces. Resources such as a <a href="../../api-v2/api/v2/lds.proto.html#envoy-api-msg-listener">Listener</a> or <a href="../../api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster">Cluster</a> may be supplied either statically in <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-static-resources">static_resources</a> or have an xDS service such as <a href="../listeners/lds.html#config-listeners-lds">LDS</a> or <a href="../cluster_manager/cds.html#config-cluster-manager-cds">CDS</a>configured in <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources">dynamic_resources</a>.</p>
<h2 id="&#x793A;&#x4F8B;">&#x793A;&#x4F8B;</h2>
<p>Below we will use YAML representation of the config protos and a running example of a service proxying HTTP from 127.0.0.1:10000 to 127.0.0.2:1234.</p>
<h3 id="&#x9759;&#x6001;">&#x9759;&#x6001;</h3>
<p>A minimal fully static bootstrap config is provided below:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">admin</span><span class="token punctuation">:</span>
  <span class="token key atrule">access_log_path</span><span class="token punctuation">:</span> /tmp/admin_access.log
  <span class="token key atrule">address</span><span class="token punctuation">:</span>
    <span class="token key atrule">socket_address</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">,</span> <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">9901 </span><span class="token punctuation">}</span>

<span class="token key atrule">static_resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">listeners</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> listener_0
    <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token key atrule">socket_address</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">,</span> <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">10000 </span><span class="token punctuation">}</span>
    <span class="token key atrule">filter_chains</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.http_connection_manager
        <span class="token key atrule">config</span><span class="token punctuation">:</span>
          <span class="token key atrule">stat_prefix</span><span class="token punctuation">:</span> ingress_http
          <span class="token key atrule">codec_type</span><span class="token punctuation">:</span> AUTO
          <span class="token key atrule">route_config</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> local_route
            <span class="token key atrule">virtual_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> local_service
              <span class="token key atrule">domains</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span>
              <span class="token key atrule">routes</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span> <span class="token punctuation">}</span>
                <span class="token key atrule">route</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> some_service <span class="token punctuation">}</span>
          <span class="token key atrule">http_filters</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.router
  <span class="token key atrule">clusters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> some_service
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STATIC
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> ROUND_ROBIN
    <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token key atrule">socket_address</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.2<span class="token punctuation">,</span> <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">1234 </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre>
<h3 id="&#x9664;&#x4E86;&#x52A8;&#x6001;-eds-&#x5927;&#x90E8;&#x5206;&#x9759;&#x6001;">&#x9664;&#x4E86;&#x52A8;&#x6001; EDS &#x5927;&#x90E8;&#x5206;&#x9759;&#x6001;</h3>
<p>A bootstrap config that continues from the above example with <a href="../../intro/arch_overview/dynamic_configuration.html#arch-overview-dynamic-config-sds">dynamic endpoint discovery</a> via an<a href="../../api-v2/api/v2/eds.proto.html#envoy-api-file-envoy-api-v2-eds-proto">EDS</a> gRPC management server listening on 127.0.0.3:5678 is provided below:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">admin</span><span class="token punctuation">:</span>
  <span class="token key atrule">access_log_path</span><span class="token punctuation">:</span> /tmp/admin_access.log
  <span class="token key atrule">address</span><span class="token punctuation">:</span>
    <span class="token key atrule">socket_address</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">,</span> <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">9901 </span><span class="token punctuation">}</span>

<span class="token key atrule">static_resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">listeners</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> listener_0
    <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token key atrule">socket_address</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">,</span> <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">10000 </span><span class="token punctuation">}</span>
    <span class="token key atrule">filter_chains</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.http_connection_manager
        <span class="token key atrule">config</span><span class="token punctuation">:</span>
          <span class="token key atrule">stat_prefix</span><span class="token punctuation">:</span> ingress_http
          <span class="token key atrule">codec_type</span><span class="token punctuation">:</span> AUTO
          <span class="token key atrule">route_config</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> local_route
            <span class="token key atrule">virtual_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> local_service
              <span class="token key atrule">domains</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span>
              <span class="token key atrule">routes</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span> <span class="token punctuation">}</span>
                <span class="token key atrule">route</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> some_service <span class="token punctuation">}</span>
          <span class="token key atrule">http_filters</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.router
  <span class="token key atrule">clusters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> some_service
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> ROUND_ROBIN
    <span class="token key atrule">type</span><span class="token punctuation">:</span> EDS
    <span class="token key atrule">eds_cluster_config</span><span class="token punctuation">:</span>
      <span class="token key atrule">eds_config</span><span class="token punctuation">:</span>
        <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
          <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
          <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>xds_cluster<span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> xds_cluster
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STATIC
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> ROUND_ROBIN
    <span class="token key atrule">http2_protocol_options</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token key atrule">socket_address</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.3<span class="token punctuation">,</span> <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">5678 </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre>
<p>Notice above that <em>xds_cluster</em> is defined to point Envoy at the management server. Even in an otherwise completely dynamic configurations, some static resources need to be defined to point Envoy at its xDS management server(s).</p>
<p>In the above example, the EDS management server could then return a proto encoding of a <a href="../../api-v2/api/v2/discovery.proto.html#envoy-api-msg-discoveryresponse">DiscoveryResponse</a>:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">version_info</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.api.v2.ClusterLoadAssignment
  <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> some_service
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
        <span class="token key atrule">address</span><span class="token punctuation">:</span>
          <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.2
            <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">1234</span>
</code></pre>
<p>The versioning and type URL scheme that appear above are explained in more detail in the <a href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md#streaming-grpc-subscriptions" target="_blank">streaming gRPC subscription protocol</a> documentation.</p>
<h3 id="&#x52A8;&#x6001;">&#x52A8;&#x6001;</h3>
<p>A fully dynamic bootstrap configuration, in which all resources other than those belonging to the management server are discovered via xDS is provided below:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">admin</span><span class="token punctuation">:</span>
  <span class="token key atrule">access_log_path</span><span class="token punctuation">:</span> /tmp/admin_access.log
  <span class="token key atrule">address</span><span class="token punctuation">:</span>
    <span class="token key atrule">socket_address</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">,</span> <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">9901 </span><span class="token punctuation">}</span>

<span class="token key atrule">dynamic_resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">lds_config</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
      <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
      <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>xds_cluster<span class="token punctuation">]</span>
  <span class="token key atrule">cds_config</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
      <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
      <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>xds_cluster<span class="token punctuation">]</span>

<span class="token key atrule">static_resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusters</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> xds_cluster
    <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
    <span class="token key atrule">type</span><span class="token punctuation">:</span> STATIC
    <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> ROUND_ROBIN
    <span class="token key atrule">http2_protocol_options</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token key atrule">socket_address</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.3<span class="token punctuation">,</span> <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">5678 </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre>
<p>The management server could respond to LDS requests with:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">version_info</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.api.v2.Listener
  <span class="token key atrule">name</span><span class="token punctuation">:</span> listener_0
  <span class="token key atrule">address</span><span class="token punctuation">:</span>
    <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
      <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.1
      <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">10000</span>
  <span class="token key atrule">filter_chains</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.http_connection_manager
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">stat_prefix</span><span class="token punctuation">:</span> ingress_http
        <span class="token key atrule">codec_type</span><span class="token punctuation">:</span> AUTO
        <span class="token key atrule">rds</span><span class="token punctuation">:</span>
          <span class="token key atrule">route_config_name</span><span class="token punctuation">:</span> local_route
          <span class="token key atrule">config_source</span><span class="token punctuation">:</span>
            <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
              <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
              <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>xds_cluster<span class="token punctuation">]</span>
        <span class="token key atrule">http_filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> envoy.router
</code></pre>
<p>The management server could respond to RDS requests with:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">version_info</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.api.v2.RouteConfiguration
  <span class="token key atrule">name</span><span class="token punctuation">:</span> local_route
  <span class="token key atrule">virtual_hosts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> local_service
    <span class="token key atrule">domains</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span> <span class="token punctuation">}</span>
      <span class="token key atrule">route</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span> some_service <span class="token punctuation">}</span>
</code></pre>
<p>The management server could respond to CDS requests with:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">version_info</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.api.v2.Cluster
  <span class="token key atrule">name</span><span class="token punctuation">:</span> some_service
  <span class="token key atrule">connect_timeout</span><span class="token punctuation">:</span> 0.25s
  <span class="token key atrule">lb_policy</span><span class="token punctuation">:</span> ROUND_ROBIN
  <span class="token key atrule">type</span><span class="token punctuation">:</span> EDS
  <span class="token key atrule">eds_cluster_config</span><span class="token punctuation">:</span>
    <span class="token key atrule">eds_config</span><span class="token punctuation">:</span>
      <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
        <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
        <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>The management server could respond to EDS requests with:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">version_info</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation">:</span> type.googleapis.com/envoy.api.v2.ClusterLoadAssignment
  <span class="token key atrule">cluster_name</span><span class="token punctuation">:</span> some_service
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">lb_endpoints</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
        <span class="token key atrule">address</span><span class="token punctuation">:</span>
          <span class="token key atrule">socket_address</span><span class="token punctuation">:</span>
            <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.2
            <span class="token key atrule">port_value</span><span class="token punctuation">:</span> <span class="token number">1234</span>
</code></pre>
<h2 id="&#x7BA1;&#x7406;&#x670D;&#x52A1;&#x5668;">&#x7BA1;&#x7406;&#x670D;&#x52A1;&#x5668;</h2>
<p>A v2 xDS management server will implement the below endpoints as required for gRPC and/or REST serving. In both streaming gRPC and REST-JSON cases, a <a href="../../api-v2/api/v2/discovery.proto.html#envoy-api-msg-discoveryrequest">DiscoveryRequest</a> is sent and a<a href="../../api-v2/api/v2/discovery.proto.html#envoy-api-msg-discoveryresponse">DiscoveryResponse</a> received following the <a href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md" target="_blank">xDS protocol</a>.</p>
<h3 id="grpc-streaming-&#x7AEF;&#x70B9;">gRPC streaming &#x7AEF;&#x70B9;</h3>
<ul>
<li><code>POST /envoy.api.v2.ClusterDiscoveryService/StreamClusters</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/cds.proto" target="_blank">cds.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">cds_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources">dynamic_resources</a> of the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> config.</p>
<ul>
<li><code>POST /envoy.api.v2.EndpointDiscoveryService/StreamEndpoints</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/eds.proto" target="_blank">eds.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">eds_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/api/v2/cds.proto.html#envoy-api-field-cluster-eds-cluster-config">eds_cluster_config</a> field of the <a href="../../api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster">Cluster</a> config.</p>
<ul>
<li><code>POST ``/envoy.api.v2.ListenerDiscoveryService/StreamListeners</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/lds.proto" target="_blank">lds.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">lds_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources">dynamic_resources</a> of the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> config.</p>
<ul>
<li><code>POST /envoy.api.v2.RouteDiscoveryService/StreamRoutes</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/rds.proto" target="_blank">rds.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">route_config_name</span><span class="token punctuation">:</span> some_route_name
<span class="token key atrule">config_source</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto.html#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-rds">rds</a> field of the <a href="../../api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto.html#envoy-api-msg-config-filter-network-http-connection-manager-v2-httpconnectionmanager">HttpConnectionManager</a> config.</p>
<h3 id="rest-&#x7AEF;&#x70B9;">REST &#x7AEF;&#x70B9;</h3>
<ul>
<li><code>POST /v2/discovery:clusters</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/cds.proto" target="_blank">cds.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">cds_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> REST
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources">dynamic_resources</a> of the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> config.</p>
<ul>
<li><code>POST /v2/discovery:endpoints</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/eds.proto" target="_blank">eds.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">eds_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> REST
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/api/v2/cds.proto.html#envoy-api-field-cluster-eds-cluster-config">eds_cluster_config</a> field of the <a href="../../api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster">Cluster</a> config.</p>
<ul>
<li><code>POST /v2/discovery:listeners</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/lds.proto" target="_blank">lds.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">lds_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> REST
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources">dynamic_resources</a> of the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> config.</p>
<ul>
<li><code>POST /v2/discovery:routes</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/rds.proto" target="_blank">rds.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">route_config_name</span><span class="token punctuation">:</span> some_route_name
<span class="token key atrule">config_source</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> REST
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto.html#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-rds">rds</a> field of the <a href="../../api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto.html#envoy-api-msg-config-filter-network-http-connection-manager-v2-httpconnectionmanager">HttpConnectionManager</a> config.</p>
<h2 id="&#x805A;&#x5408;&#x53D1;&#x73B0;&#x670D;&#x52A1;">&#x805A;&#x5408;&#x53D1;&#x73B0;&#x670D;&#x52A1;</h2>
<p>While Envoy fundamentally employs an eventual consistency model, ADS provides an opportunity to sequence API update pushes and ensure affinity of a single management server for an Envoy node for API updates. ADS allows one or more APIs and their resources to be delivered on a single, bidirectional gRPC stream by the management server. Without this, some APIs such as RDS and EDS may require the management of multiple streams and connections to distinct management servers.</p>
<p>ADS will allow for hitless updates of configuration by appropriate sequencing. For example, suppose <em>foo.com</em> was mappped to cluster <em>X</em>. We wish to change the mapping in the route table to point <em>foo.com</em> at cluster <em>Y</em>. In order to do this, a CDS/EDS update must first be delivered containing both clusters <em>X</em> and <em>Y</em>.</p>
<p>Without ADS, the CDS/EDS/RDS streams may point at distinct management servers, or when on the same management server at distinct gRPC streams/connections that require coordination. The EDS resource requests may be split across two distinct streams, one for <em>X</em> and one for <em>Y</em>. ADS allows these to be coalesced to a single stream to a single management server, avoiding the need for distributed synchronization to correctly sequence the update. With ADS, the management server would deliver the CDS, EDS and then RDS updates on a single stream.</p>
<p>ADS is only available for gRPC streaming (not REST) and is described more fully in <a href="https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md#aggregated-discovery-services-ads" target="_blank">this</a> document. The gRPC endpoint is:</p>
<ul>
<li><code>POST /envoy.api.v2.AggregatedDiscoveryService/StreamAggregatedResources</code></li>
</ul>
<p>See <a href="https://github.com/envoyproxy/data-plane-api/blob/master/envoy/api/v2/discovery.proto" target="_blank">discovery.proto</a> for the service definition. This is used by Envoy as a client when</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">ads_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_type</span><span class="token punctuation">:</span> GRPC
  <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_ads_cluster<span class="token punctuation">]</span>
</code></pre>
<p>is set in the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources">dynamic_resources</a> of the <a href="../../api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> config.</p>
<p>When this is set, any of the configuration sources <a href="#v2-grpc-streaming-endpoints">above</a> can be set to use the ADS channel. For example, a LDS config could be changed from</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">lds_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_config_source</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_type</span><span class="token punctuation">:</span> REST
    <span class="token key atrule">cluster_names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>some_xds_cluster<span class="token punctuation">]</span>
</code></pre>
<p>to</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">lds_config</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">ads</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre>
<p>with the effect that the LDS stream will be directed to <em>some_ads_cluster</em> over the shared ADS channel.</p>
<h2 id="&#x7BA1;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x53EF;&#x8FBE;">&#x7BA1;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x53EF;&#x8FBE;</h2>
<p>When Envoy instance looses connectivity with the management server, Envoy will latch on to the previous configuration while actively retrying in the background to reestablish the connection with the management server.</p>
<p>Envoy debug logs the fact that it is not able to establish a connection with the management server every time it attempts a connection.</p>
<p><a href="../cluster_manager/cluster_stats.html#config-cluster-manager-cluster-stats">upstream_cx_connect_fail</a> a cluster level statistic of the cluster pointing to management server provides a signal for monitoring this behavior.</p>
<h2 id="&#x72B6;&#x6001;">&#x72B6;&#x6001;</h2>
<p>All features described in the <a href="../../api-v2/api.html#envoy-api-reference">v2 API reference</a> are implemented unless otherwise noted. In the v2 API reference and the <a href="https://github.com/envoyproxy/data-plane-api/tree/master" target="_blank">v2 API repository</a>, all protos are <em>frozen</em> unless they are tagged as <em>draft</em> or <em>experimental</em>. Here, <em>frozen</em> means that we will not break wire format compatibility.</p>
<p><em>Frozen</em> protos may be further extended, e.g. by adding new fields, in a manner that does not break <a href="https://developers.google.com/protocol-buffers/docs/overview#how-do-they-work" target="_blank">backwards compatibility</a>. Fields in the above protos may be later deprecated, subject to the<a href="https://github.com/envoyproxy/envoy/blob/master//CONTRIBUTING.md#breaking-change-policy" target="_blank">breaking change policy</a>, when their related functionality is no longer required. While frozen APIs have their wire format compatibility preserved, we reserve the right to change proto namespaces, file locations and nesting relationships, which may cause breaking code changes. We will aim to minimize the churn here.</p>
<p>Protos tagged <em>draft</em>, meaning that they are near finalized, are likely to be at least partially implemented in Envoy but may have wire format breaking changes made prior to freezing.</p>
<p>Protos tagged <em>experimental</em>, have the same caveats as draft protos and may have have major changes made prior to Envoy implementation and freezing.</p>
<p>The current open v2 API issues are tracked <a href="https://github.com/envoyproxy/envoy/issues?q=is%3Aopen+is%3Aissue+label%3A%22v2+API%22" target="_blank">here</a>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="v1_overview.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: v1 API 概览">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"v2 API 概览","level":"5.2","depth":1,"next":{"title":"Listener","level":"5.3","depth":1,"ref":"","articles":[{"title":"统计","level":"5.3.1","depth":2,"path":"configuration/listeners/stats.md","ref":"configuration/listeners/stats.md","articles":[]},{"title":"运行时","level":"5.3.2","depth":2,"path":"configuration/listeners/runtime.md","ref":"configuration/listeners/runtime.md","articles":[]},{"title":"Listener 发现服务（LDS）","level":"5.3.3","depth":2,"path":"configuration/listeners/lds.md","ref":"configuration/listeners/lds.md","articles":[]}]},"previous":{"title":"v1 API 概览","level":"5.1","depth":1,"path":"configuration/overview/v1_overview.md","ref":"configuration/overview/v1_overview.md","articles":[]},"dir":"ltr"},"config":{"plugins":["splitter","-lunr","-search","search-plus","-sharing","theme-default","edit-link","page-toc-button","back-to-top-button","github-buttons@2.1.0","-highlight","prism","prism-themes"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"prism":{"css":["prism-themes/themes/prism-ghcolors.css"]},"splitter":{},"fontsettings":{"theme":"white","family":"sans","size":2},"page-toc-button":{},"back-to-top-button":{},"prism-themes":{},"github-buttons":{"repo":"servicemesher/envoyproxy","types":["star"],"size":"small"},"edit-link":{"label":"在线编辑","base":"https://github.com/servicemesher/envoyproxy/edit/master"},"theme-default":{"showLevel":true,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"search-plus":{}},"theme":"default","author":"ServiceMesher","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Envoy proxy中文文档","language":"zh-hans","gitbook":">=3.2.0","description":"Envoy proxy中文文档","extension":null},"file":{"path":"configuration/overview/v2_overview.md","mtime":"2018-05-15T10:02:43.450Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-15T14:14:17.083Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

